<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoLog</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>AutoLog</h1>
            <p>A calm space to track vehicles and every service milestone.</p>
        </div>

        <!-- Alert Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Action Bar: Add Button and Search -->
        <div class="action-bar">
            <a href="/add_vehicle" class="btn btn-primary">Add Vehicle</a>
            
            <!-- Search Form -->
            <form method="GET" action="/" class="search-container">
                <input 
                    type="text" 
                    name="search" 
                    class="search-input" 
                    placeholder="Search by brand, model, or plate number..."
                    value="{{ search_query }}"
                >
            </form>
        </div>

        <!-- Section Header -->
        <div class="section-header">
            <h2>Garage</h2>
            {% if vehicles %}
                <span class="section-subtle">{{ vehicles|length }} vehicle{{ vehicles|length > 1 and 's' or '' }}</span>
            {% endif %}
        </div>

        <!-- Vehicles Grid -->
        {% if vehicles %}
            <div class="vehicles-grid">
                {% for v in vehicles %}
                <div class="vehicle-card">
                    <div class="vehicle-header">
                        <div class="vehicle-brand">{{ v.brand }}</div>
                        <div class="vehicle-model">{{ v.model }}</div>
                    </div>
                    <div class="vehicle-details">
                        <span><strong>Year</strong> {{ v.year }}</span>
                        <span><strong>Plate</strong> {{ v.plate_number }}</span>
                        <span><strong>ID</strong> #{{ v.id }}</span>
                    </div>
                    <div class="vehicle-actions">
                        <a href="{{ url_for('view_vehicle', vehicle_id=v.id) }}" class="btn btn-secondary btn-small">View</a>
                        <a href="{{ url_for('edit_vehicle', vehicle_id=v.id) }}" class="btn btn-primary btn-small">Edit</a>
                        <form method="POST" action="{{ url_for('delete_vehicle', vehicle_id=v.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this vehicle?');">
                            <button type="submit" class="btn btn-danger btn-small">Delete</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h3>No vehicles yet</h3>
                <p>{% if search_query %}Adjust your search and try again.{% else %}Keep things tidy by logging your first vehicle.{% endif %}</p>
                {% if not search_query %}
                    <a href="/add_vehicle" class="btn btn-primary mt-20">Add a vehicle</a>
                {% endif %}
            </div>
        {% endif %}

        <!-- Statistics -->
        {% if total > 0 %}
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value">{{ total }}</div>
                <div class="stat-label">Total Vehicles</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ oldest }}</div>
                <div class="stat-label">Oldest Vehicle</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ newest }}</div>
                <div class="stat-label">Newest Vehicle</div>
            </div>
        </div>
        {% endif %}
    </div>
</body>
</html>
